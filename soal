#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <time.h>
#include <unistd.h>
#include "cross-platform.h"

void clear_terminal()
    {printf("\e[1;1H\e[2J");} 

    /* Fungsi ini mengisi nilai satu sampai dengan jumlahElemen ke dalam 
   sebuah pointer array dengan urutan acak. Berguna untuk membuat pemilihan
   soal secara acak */
int *ptrElemenAcak(int jumlahElemen) {
    int *idx = malloc(jumlahElemen * sizeof(int));
    int penanda[jumlahElemen]; // Array penanda

    for (int i = 0; i < jumlahElemen; i++) {
        penanda[i] = 0; // Inisialisasi ke 0
    }

    srand(time(NULL));
    for (int i = 0; i < jumlahElemen; i++) {
        int indexAcak;
        do {
            indexAcak = rand() % jumlahElemen; // Menghasilkan angka acak
        } while (penanda[indexAcak] == 1); // Ulangi jika angka sudah digunakan

        idx[i] = indexAcak;       // Simpan angka acak yang valid
        penanda[indexAcak] = 1;   // Menandai angka yang sudah digunakan
    }

    return idx;
}

typedef struct {
    char *soal;
    char jawaban;
} Pertanyaan;

int main() {
    int uang = 0;
    int maxSoal = 10;
    int *idx = ptrElemenAcak(maxSoal);
    const short int opsi[] = {'a', 'b', 'c', 'd'};
    char jawabanPengguna;
    
    Pertanyaan kumpulanSoal[15] = {
        {"Mata uang Kamboja? \n a. Riyal\n b. Riel\n c. Real\n d. Rand", 'b'},
        {"(36 x 2) / 0 = ? \n a. 0\n b. Tak terdefinisi\n c. Tak hingga\n d. 1", 'b'},
        {"Jumlah kotak hitam papan catur? \n a. 68\n b. 34\n c. 64\n d. 32", 'd'},
        {"Hewan tercepat di dunia?\n a. Harimau\n b. Macan\n c. Singa\n d. Cheetah", 'd'},
        {"Ibu kota Kalimantan Barat?\n a. Palangkaraya\n b. Banjarbaru\n c. Pontianak\n d. Samarinda", 'c'},
        {"Jumlah provinsi di Indonesia?\n a. 38\n b. 34\n c. 40\n d. 32", 'a'},
        {"Kota terpadat di dunia?\n a. Shanghai, China\n b. Tokyo, Jepang\n c. Mumbai, India\n d. Beijing, China", 'b'},
        {"Danau terbesar di dunia?\n a. Superior\n b. Huron\n c. Kaspia\n d. Sentani", 'c'},
        {"Hewan terbesar di dunia?\n a. Kucing\n b. Beruang kodiak\n c. Gajah\n d. Paus biru", 'd'},
        {"Hari Kesaktian Pancasila?\n a. 18 Agustus\n b. 22 Juni\n c. 1 Oktober\n d. 1 Juni", 'c'},
        {"Sungai terpanjang di Indonesia? \n a. Kapuas\n b. Nil\n c. Amazon\n d. Mahakam\n", 'a'},
        {"Negara terkaya di dunia? \n a. Qatar\n b. Luxemburg\n c. Makau\n d. China", 'b'},
        {"Ibu kota Prancis? \n a. Berlin\n b. Madrid\n c. Paris\n d. Roma", 'c'},
		{"Planet terjauh dari bumi? a. Uranus\n b. Saturnus\n c. Neptunus\n d. Merkurius", 'c'},
		{"Siapakah bapak ekonomi? \n a. Adam Watson\n b. Karl Marx\n c. Thomas Edison\n d. Adam Smith", 'd'}
    };

    for (int i = 0; i < maxSoal; i++) {
        clear_terminal();
        printf("===================================================\n");
        printf("  Soal %d:\n  %s \n", i + 1, kumpulanSoal[idx[i]].soal);
        printf("  >> ");

        while (1) {  
            jawabanPengguna = '0';
            jawabanPengguna = char_tanpa_buffer();

            int flag = 0;
            for (int i = 0; i < sizeof(opsi)/sizeof(opsi[0]); i++)
            {    
                if (jawabanPengguna == opsi[i])
                {
                    flag = 1;
                    break;
                }
            }
                    
            if (!flag)
                continue;

            if (jawabanPengguna == kumpulanSoal[idx[i]].jawaban) 
            {
                uang += 1000000;
                printf("Jawaban Anda benar. Tekan n untuk melanjutkan..");
                
                char lanjut;
                do{
                    lanjut = char_tanpa_buffer();
                } while(lanjut != 'n');
                
                break;
            }

            else 
            {
                clear_terminal();
                printf("\nJawaban anda salah! Permainan berakhir.\n");
                free(idx);
                return 0;
            }
        }
    }        

    // Jika semua soal dijawab benar
    clear_terminal();
    printf("Selamat! Anda berhasil menjawab semua soal dengan benar!\n");
    printf("Skor akhir: %d\n", uang);
    printf("===================================================\n");
    free(idx);
    
    return 0;
    
}
